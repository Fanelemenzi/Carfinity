{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ section_data.name }} - Assessment Detail{% endblock %}

{% block extra_css %}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/responsive-claims-dashboard.css' %}" data-critical="true">
<link rel="stylesheet" href="{% static 'css/notifications.css' %}">
<link rel="stylesheet" href="{% static 'css/optimized-dashboard.min.css' %}" data-critical="true">
<link rel="stylesheet" href="{% static 'css/dashboard-integration.css' %}" data-critical="false">
<link rel="stylesheet" href="{% static 'css/assessment-detail.css' %}">
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    primary: '#1e40af',
                    secondary: '#374151',
                    accent: '#f59e0b',
                    success: '#10b981',
                    warning: '#f59e0b',
                    danger: '#ef4444'
                }
            }
        }
    }
</script>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50" x-data="sectionDetailData()">
        <!-- Header Section -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 mobile-dashboard">
                <!-- Breadcrumb -->
                <nav class="flex mb-4" aria-label="Breadcrumb">
                    <ol class="inline-flex items-center space-x-1 md:space-x-3">
                        <li class="inline-flex items-center">
                            <a href="{% url 'insurance:assessment_dashboard' %}" class="inline-flex items-center text-sm font-medium text-blue-100 hover:text-white transition-colors duration-200">
                                <div class="w-6 h-6 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-2">
                                    <i class="fas fa-tachometer-alt text-xs"></i>
                                </div>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <div class="flex items-center">
                                <i class="fas fa-chevron-right text-blue-300 mx-2"></i>
                                <a href="{% url 'insurance:assessment_detail' claim_id %}" class="ml-1 text-sm font-medium text-blue-100 hover:text-white md:ml-2 transition-colors duration-200">
                                    Claim {{ claim_id }}
                                </a>
                            </div>
                        </li>
                        <li aria-current="page">
                            <div class="flex items-center">
                                <i class="fas fa-chevron-right text-blue-300 mx-2"></i>
                                <span class="ml-1 text-sm font-medium text-blue-200 md:ml-2">{{ section_data.name }}</span>
                            </div>
                        </li>
                    </ol>
                </nav>

                <!-- Section Header -->
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="flex items-center mb-4 lg:mb-0">
                        <div class="w-16 h-16 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4 glass-effect">
                            <span class="text-3xl">{{ section_data.icon }}</span>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold text-white mobile-title">{{ section_data.name }}</h1>
                            <p class="text-blue-100 mt-1 mobile-subtitle">Detailed component breakdown and damage assessment</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Progress Circle -->
                        <div class="relative w-16 h-16">
                            <svg class="w-16 h-16 progress-ring" viewBox="0 0 36 36">
                                <path class="progress-ring-circle text-white text-opacity-30"
                                      stroke="currentColor"
                                      stroke-width="3"
                                      fill="transparent"
                                      d="M18 2.0845
                                         a 15.9155 15.9155 0 0 1 0 31.831
                                         a 15.9155 15.9155 0 0 1 0 -31.831"
                                      stroke-dasharray="100, 100">
                                </path>
                                <path class="progress-ring-circle text-white"
                                      stroke="currentColor"
                                      stroke-width="3"
                                      fill="transparent"
                                      d="M18 2.0845
                                         a 15.9155 15.9155 0 0 1 0 31.831
                                         a 15.9155 15.9155 0 0 1 0 -31.831"
                                      :stroke-dasharray="`${sectionData.completion_percentage}, 100`">
                                </path>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-sm font-semibold text-white" x-text="`${sectionData.completion_percentage}%`"></span>
                            </div>
                        </div>
                        <button onclick="window.history.back()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center mobile-button glass-effect">
                            <i class="fas fa-arrow-left mr-2"></i>
                            <span class="hidden sm:inline">Back to Assessment</span>
                            <span class="sm:hidden">Back</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 mobile-dashboard">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 stats-grid mobile-stats-grid">
                <!-- Status Card -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 card-hover assessment-section-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-clipboard-check text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Status</p>
                            <p class="text-lg font-semibold text-gray-900" x-text="sectionData.status"></p>
                        </div>
                    </div>
                </div>

                <!-- Damage Level Card -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 card-hover assessment-section-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-exclamation-triangle text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Damage Level</p>
                            <p class="text-lg font-semibold text-gray-900" x-text="sectionData.damage_level"></p>
                        </div>
                    </div>
                </div>

                <!-- Estimated Cost Card -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 card-hover assessment-section-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-pound-sign text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Estimated Cost</p>
                            <p class="text-lg font-semibold text-gray-900" x-text="sectionData.estimated_cost"></p>
                        </div>
                    </div>
                </div>

                <!-- Components Card -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 card-hover assessment-section-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-cogs text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Components</p>
                            <p class="text-lg font-semibold text-gray-900" x-text="`${sectionData.component_count} items`"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Components List -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-200 action-card">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-list text-white text-sm"></i>
                        </div>
                        Component Details
                    </h2>
                    <p class="text-gray-600 mt-1 mobile-subtitle">Individual assessment of each component in this section</p>
                </div>

                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mobile-action-cards">
                        <template x-for="component in sectionData.components" :key="component.name">
                            <div class="component-card assessment-detail-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border border-gray-200 p-4 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="font-medium text-gray-900" x-text="component.name"></h3>
                                    <span :class="getSeverityBadgeClass(component.severity)" 
                                          class="severity-badge px-3 py-1 rounded-full text-xs font-medium" 
                                          x-text="component.severity"></span>
                                </div>
                                
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-500">Status:</span>
                                        <span :class="getStatusClass(component.status)" 
                                              class="text-sm font-medium" 
                                              x-text="component.status"></span>
                                    </div>
                                    
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-500">Repair Cost:</span>
                                        <span :class="component.cost === '£0' ? 'text-green-600' : 'text-red-600'" 
                                              class="text-sm font-medium" 
                                              x-text="component.cost"></span>
                                    </div>
                                </div>

                                <!-- Component Actions -->
                                <div class="mt-4 pt-3 border-t border-gray-200">
                                    <div class="flex space-x-2">
                                        <button class="flex-1 bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 text-blue-700 text-xs font-medium py-2 px-3 rounded-lg transition-all duration-200 mobile-button">
                                            <i class="fas fa-eye mr-1"></i>
                                            View Photos
                                        </button>
                                        <button class="flex-1 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 text-gray-700 text-xs font-medium py-2 px-3 rounded-lg transition-all duration-200 mobile-button">
                                            <i class="fas fa-file-alt mr-1"></i>
                                            Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-8 flex flex-col sm:flex-row justify-between items-center gap-4">
                <button onclick="window.history.back()" class="w-full sm:w-auto bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 px-6 py-3 rounded-xl transition-all duration-200 flex items-center justify-center mobile-button action-button">
                    <i class="fas fa-arrow-left mr-2"></i>
                    <span class="hidden sm:inline">Back to Assessment Overview</span>
                    <span class="sm:hidden">Back</span>
                </button>
                
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto">
                    <button class="w-full sm:w-auto bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-xl transition-all duration-200 flex items-center justify-center mobile-button action-button">
                        <i class="fas fa-download mr-2"></i>
                        Export Report
                    </button>
                    <button class="w-full sm:w-auto bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-6 py-3 rounded-xl transition-all duration-200 flex items-center justify-center mobile-button action-button">
                        <i class="fas fa-check mr-2"></i>
                        Mark Complete
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
function sectionDetailData() {
    return {
        sectionData: JSON.parse('{{ section_data|escapejs }}') || {
            name: 'Loading...',
            icon: '⏳',
            status: 'Loading',
            damage_level: 'Unknown',
            estimated_cost: '£0',
            component_count: 0,
            completion_percentage: 0,
            components: []
        },
        
        getSeverityBadgeClass(severity) {
            const classes = {
                'Severe': 'bg-red-100 text-red-800',
                'Major': 'bg-orange-100 text-orange-800',
                'Moderate': 'bg-yellow-100 text-yellow-800',
                'Minor': 'bg-blue-100 text-blue-800',
                'None': 'bg-green-100 text-green-800',
                'Unknown': 'bg-gray-100 text-gray-800'
            };
            return classes[severity] || 'bg-gray-100 text-gray-800';
        },
        
        getStatusClass(status) {
            const statusClasses = {
                'Good': 'text-green-600',
                'Damaged': 'text-red-600',
                'Worn': 'text-yellow-600',
                'Scratched': 'text-orange-600',
                'Cracked': 'text-red-600',
                'Bent': 'text-red-600',
                'Dented': 'text-orange-600',
                'Torn': 'text-red-600',
                'Stained': 'text-yellow-600',
                'Scuffed': 'text-orange-600',
                'Deployed': 'text-red-600',
                'Low': 'text-yellow-600',
                'Dirty': 'text-yellow-600',
                'Pending': 'text-gray-600'
            };
            return statusClasses[status] || 'text-gray-600';
        }
    }
}

// Initialize Alpine.js data
document.addEventListener('DOMContentLoaded', function() {
    // Any additional initialization can go here
});
</script>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
{% endblock %}
