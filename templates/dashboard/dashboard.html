{% extends 'base/base.html'%}
{% load static %}
{% load dashboard_extras %}

{% block title %}Vehicle Dashboard - Carfinity{% endblock %}

{% block content %}
<br></br>
{% if user.is_authenticated %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vehicle Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1e40af',
            secondary: '#374151',
            accent: '#f59e0b',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444'
          }
        }
      }
    }
  </script>
  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>

<body class="bg-gray-50">
  <!-- Navigation -->
  <nav class="bg-white shadow-lg border-b border-gray-200 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-12 sm:h-16">
        <!-- Left Side - Logo and Navigation -->
        <div class="flex items-center space-x-1 sm:space-x-8">
          <!-- Mobile Menu Button - Moved to left for better thumb access -->
          <button class="lg:hidden p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md touch-manipulation" 
            x-data x-on:click="$dispatch('toggle-mobile-menu')" aria-label="Open menu">
            <i class="fas fa-bars text-lg"></i>
          </button>
          
          <div class="flex-shrink-0">
            <h1 class="text-base sm:text-xl font-bold text-gray-900">
              <i class="fas fa-car text-primary mr-1 sm:mr-2 text-sm sm:text-base"></i>
              <span class="hidden sm:inline">Vehicle Dashboard</span>
              <span class="sm:hidden">Dashboard</span>
            </h1>
          </div>
          
          <!-- Quick Navigation Links - Desktop Only -->
          <div class="hidden lg:flex items-center space-x-6">
            <a href="{% url 'dashboard' %}" class="text-sm font-medium text-gray-700 hover:text-primary transition duration-200 
              {% if request.resolver_match.url_name == 'dashboard' %}text-primary border-b-2 border-primary{% endif %}">
              <i class="fas fa-tachometer-alt mr-1"></i>Overview
            </a>
            {% if user|has_group:'AutoCare' or user|has_group:'AutoAssess' %}
            <a href="{% url 'maintenance_history:technician_dashboard' %}" class="text-sm font-medium text-gray-700 hover:text-primary transition duration-200">
              <i class="fas fa-tools mr-1"></i>Technician
            </a>
            {% endif %}
            <a href="{% url 'search' %}" class="text-sm font-medium text-gray-700 hover:text-primary transition duration-200">
              <i class="fas fa-search mr-1"></i>VIN Search
            </a>
          </div>
        </div>

        <!-- Right Side - Mobile Optimized -->
        <div class="flex items-center space-x-1 sm:space-x-3">
          <!-- Vehicle Selector - Mobile Optimized -->
          <div class="relative" x-data="{ vehicleOpen: false }">
            <!-- Mobile Vehicle Button -->
            <button @click="vehicleOpen = !vehicleOpen" @click.away="vehicleOpen = false"
              class="lg:hidden flex items-center p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition duration-200 touch-manipulation min-w-[44px] min-h-[44px] justify-center"
              aria-label="Select vehicle">
              <i class="fas fa-car text-base"></i>
              {% if navbar_data.quick_stats.total_vehicles > 0 %}
                <span class="absolute -top-1 -right-1 text-xs bg-primary text-white rounded-full px-1 py-0.5 min-w-[16px] text-center leading-none">
                  {{ navbar_data.quick_stats.total_vehicles }}
                </span>
              {% endif %}
            </button>
            
            <!-- Desktop Vehicle Selector -->
            <form method="get" action="" class="hidden lg:flex items-center space-x-2">
              <select class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:border-primary" name="vehicle_id">
                <option value="">Select Vehicle</option>
                {% for ownership in owned_vehicles %}
                  <option value="{{ ownership.vehicle.id }}" 
                      {% if ownership.vehicle.id|stringformat:'s' == request.GET.vehicle_id %}selected{% endif %}>
                      {{ ownership.vehicle.make }} {{ ownership.vehicle.model }} ({{ ownership.vehicle.vin }})
                  </option>
                {% endfor %}
              </select>
              <button type="submit"
                class="bg-primary text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 transition duration-200">
                <i class="fas fa-search mr-2"></i>View
              </button>
            </form>

            <!-- Mobile Vehicle Dropdown -->
            <div x-show="vehicleOpen" x-transition:enter="transition ease-out duration-200" 
              x-transition:enter-start="opacity-0 transform scale-95" 
              x-transition:enter-end="opacity-100 transform scale-100" 
              x-transition:leave="transition ease-in duration-150" 
              x-transition:leave-start="opacity-100 transform scale-100" 
              x-transition:leave-end="opacity-0 transform scale-95" 
              class="lg:hidden absolute right-0 mt-2 w-80 max-w-[calc(100vw-1rem)] bg-white rounded-lg shadow-xl border border-gray-200 z-50">
              
              <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                <h3 class="text-sm font-semibold text-gray-900">Select Vehicle</h3>
                <p class="text-xs text-gray-500 mt-1">{{ navbar_data.quick_stats.total_vehicles }} vehicle{{ navbar_data.quick_stats.total_vehicles|pluralize }} available</p>
              </div>
              
              <form method="get" action="" class="p-4">
                <select class="w-full border border-gray-300 rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-primary focus:border-primary mb-4 touch-manipulation" name="vehicle_id">
                  <option value="">All Vehicles</option>
                  {% for ownership in owned_vehicles %}
                    <option value="{{ ownership.vehicle.id }}" 
                        {% if ownership.vehicle.id|stringformat:'s' == request.GET.vehicle_id %}selected{% endif %}>
                        {{ ownership.vehicle.make }} {{ ownership.vehicle.model }} • {{ ownership.vehicle.vin|slice:"-4" }}
                    </option>
                  {% endfor %}
                </select>
                <button type="submit"
                  class="w-full bg-primary text-white px-4 py-3 rounded-lg text-sm font-medium hover:bg-blue-700 transition duration-200 touch-manipulation">
                  <i class="fas fa-search mr-2"></i>View Selected Vehicle
                </button>
              </form>
            </div>
          </div>

          <!-- Notifications Bell - Mobile Optimized -->
          {% if navbar_data.notification_count > 0 %}
          <div class="relative" x-data="{ open: false }">
            <button @click="open = !open" @click.away="open = false" 
              class="relative p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full transition duration-200 touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
              aria-label="View notifications">
              <i class="fas fa-bell text-base"></i>
              <span class="absolute -top-1 -right-1 inline-flex items-center justify-center px-1 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full min-w-[16px] h-4">
                {{ navbar_data.notification_count }}
              </span>
            </button>
            
            <!-- Mobile-Optimized Notifications Dropdown -->
            <div x-show="open" x-transition:enter="transition ease-out duration-200" 
              x-transition:enter-start="opacity-0 transform scale-95" 
              x-transition:enter-end="opacity-100 transform scale-100" 
              x-transition:leave="transition ease-in duration-150" 
              x-transition:leave-start="opacity-100 transform scale-100" 
              x-transition:leave-end="opacity-0 transform scale-95" 
              class="absolute right-0 mt-2 w-80 max-w-[calc(100vw-1rem)] bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[80vh] overflow-hidden">
              
              <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                <h3 class="text-sm font-semibold text-gray-900">Notifications</h3>
                <p class="text-xs text-gray-500">{{ navbar_data.notification_count }} unread notification{{ navbar_data.notification_count|pluralize }}</p>
              </div>
              
              <div class="max-h-64 overflow-y-auto overscroll-contain">
                {% for notification in navbar_data.notifications %}
                <a href="{{ notification.url }}" class="block px-4 py-4 hover:bg-gray-50 active:bg-gray-100 transition duration-150 border-b border-gray-100 last:border-b-0 touch-manipulation">
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 mt-0.5">
                      <div class="w-8 h-8 rounded-full flex items-center justify-center
                        {% if notification.type == 'critical' %}bg-red-100
                        {% elif notification.type == 'warning' %}bg-yellow-100
                        {% elif notification.type == 'info' %}bg-blue-100
                        {% else %}bg-gray-100{% endif %}">
                        <i class="{{ notification.icon }} text-sm
                          {% if notification.type == 'critical' %}text-red-600
                          {% elif notification.type == 'warning' %}text-yellow-600
                          {% elif notification.type == 'info' %}text-blue-600
                          {% else %}text-gray-600{% endif %}"></i>
                      </div>
                    </div>
                    <div class="flex-1 min-w-0">
                      <p class="text-sm font-medium text-gray-900 leading-tight">{{ notification.title }}</p>
                      <p class="text-sm text-gray-600 mt-1 leading-relaxed">{{ notification.message }}</p>
                      <p class="text-xs text-gray-400 mt-2">{{ notification.timestamp|timesince }} ago</p>
                    </div>
                  </div>
                </a>
                {% endfor %}
              </div>
              
              <div class="px-4 py-3 border-t border-gray-200 bg-gray-50">
                <a href="#" class="block text-center text-sm text-primary hover:text-blue-800 font-medium py-1 touch-manipulation">
                  View all notifications
                </a>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Mobile Status Indicator -->
          {% if dashboard_metrics.overdue_maintenance > 0 %}
          <div class="flex sm:hidden items-center justify-center w-8 h-8 bg-red-100 text-red-800 rounded-full">
            <span class="text-xs font-bold">{{ dashboard_metrics.overdue_maintenance }}</span>
          </div>
          {% elif dashboard_metrics.upcoming_maintenance > 0 %}
          <div class="flex sm:hidden items-center justify-center w-8 h-8 bg-yellow-100 text-yellow-800 rounded-full">
            <span class="text-xs font-bold">{{ dashboard_metrics.upcoming_maintenance }}</span>
          </div>
          {% endif %}

          <!-- Desktop Quick Stats Badge -->
          {% if dashboard_metrics.overdue_maintenance > 0 %}
          <div class="hidden sm:flex items-center bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-medium">
            <i class="fas fa-exclamation-triangle mr-1"></i>
            {{ dashboard_metrics.overdue_maintenance }} Overdue
          </div>
          {% elif dashboard_metrics.upcoming_maintenance > 0 %}
          <div class="hidden sm:flex items-center bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-medium">
            <i class="fas fa-clock mr-1"></i>
            {{ dashboard_metrics.upcoming_maintenance }} Due Soon
          </div>
          {% endif %}

          <!-- User Profile Dropdown - Mobile Optimized -->
          <div class="relative" x-data="{ open: false }">
            <button @click="open = !open" @click.away="open = false" 
              class="flex items-center text-sm text-gray-700 hover:text-gray-900 bg-gray-50 hover:bg-gray-100 rounded-lg px-2 py-1.5 transition duration-200 touch-manipulation min-w-[44px] min-h-[44px]"
              aria-label="User menu">
              <div class="w-7 h-7 bg-primary bg-opacity-20 rounded-full flex items-center justify-center mr-1 sm:mr-2">
                <i class="fas fa-user text-primary text-xs"></i>
              </div>
              <div class="hidden md:block text-left">
                <p class="text-xs text-gray-500">{{ user.get_full_name|default:user.username|truncatechars:12 }}</p>
              </div>
              <svg class="w-3 h-3 ml-1 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            
            <!-- Mobile-Optimized User Dropdown Menu -->
            <div x-show="open" x-transition:enter="transition ease-out duration-200" 
              x-transition:enter-start="opacity-0 transform scale-95" 
              x-transition:enter-end="opacity-100 transform scale-100" 
              x-transition:leave="transition ease-in duration-150" 
              x-transition:leave-start="opacity-100 transform scale-100" 
              x-transition:leave-end="opacity-0 transform scale-95" 
              class="absolute right-0 mt-2 w-64 sm:w-72 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50">
              
              <!-- User Info Header -->
              <div class="px-3 sm:px-4 py-3 border-b border-gray-200 bg-gray-50">
                <div class="flex items-center">
                  <div class="w-10 h-10 sm:w-12 sm:h-12 bg-primary bg-opacity-20 rounded-full flex items-center justify-center mr-2 sm:mr-3">
                    <i class="fas fa-user text-primary text-sm sm:text-lg"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-xs sm:text-sm font-medium text-gray-900 truncate">{{ user.get_full_name|default:user.username }}</p>
                    <p class="text-xs sm:text-sm text-gray-600 truncate">{{ user.email }}</p>
                    <div class="flex items-center mt-1 flex-wrap">
                      {% if user|has_group:'Staff' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">
                          Staff
                        </span>
                      {% elif user|has_group:'AutoAssess' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                          AutoAssess
                        </span>
                      {% elif user|has_group:'AutoCare' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                          AutoCare
                        </span>
                      {% else %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                          User
                        </span>
                      {% endif %}
                      {% if navbar_data.quick_stats.total_vehicles > 0 %}
                        <span class="ml-2 text-xs text-gray-500">
                          {{ navbar_data.quick_stats.total_vehicles }} vehicle{{ navbar_data.quick_stats.total_vehicles|pluralize }}
                        </span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Quick Stats -->
              {% if navbar_data.quick_stats.total_vehicles > 0 %}
              <div class="px-4 py-3 border-b border-gray-200">
                <div class="grid grid-cols-3 gap-3 text-center">
                  <div>
                    <p class="text-lg font-semibold text-gray-900">{{ navbar_data.quick_stats.pending_maintenance }}</p>
                    <p class="text-xs text-gray-600">Pending</p>
                  </div>
                  <div>
                    <p class="text-lg font-semibold {% if navbar_data.quick_stats.overdue_items > 0 %}text-red-600{% else %}text-gray-900{% endif %}">
                      {{ navbar_data.quick_stats.overdue_items }}
                    </p>
                    <p class="text-xs text-gray-600">Overdue</p>
                  </div>
                  <div>
                    <p class="text-lg font-semibold text-gray-900">{{ navbar_data.quick_stats.recent_inspections }}</p>
                    <p class="text-xs text-gray-600">Recent</p>
                  </div>
                </div>
              </div>
              {% endif %}
              
              <!-- Menu Items -->
              <div class="py-1">
                <a href="{% url 'dashboard' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-tachometer-alt mr-3 w-4"></i>Dashboard
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-user mr-3 w-4"></i>Profile Settings
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-car mr-3 w-4"></i>My Vehicles
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-history mr-3 w-4"></i>Service History
                </a>
                
                {% if user|has_group:'AutoCare' or user|has_group:'AutoAssess' %}
                <div class="border-t border-gray-200 my-1"></div>
                <a href="{% url 'maintenance_history:technician_dashboard' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-tools mr-3 w-4"></i>Technician Dashboard
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-clipboard-check mr-3 w-4"></i>Inspections
                </a>
                {% endif %}
                
                {% if user|has_group:'Staff' %}
                <div class="border-t border-gray-200 my-1"></div>
                <a href="/admin/" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-shield-alt mr-3 w-4"></i>Admin Panel
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-users mr-3 w-4"></i>User Management
                </a>
                {% endif %}
                
                <div class="border-t border-gray-200 my-1"></div>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-cog mr-3 w-4"></i>Settings
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-question-circle mr-3 w-4"></i>Help & Support
                </a>
                <a href="{% url 'logout' %}" class="flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition duration-150">
                  <i class="fas fa-sign-out-alt mr-3 w-4"></i>Logout
                </a>
              </div>
            </div>
          </div>


        </div>
      </div>
    </div>

    <!-- Mobile Menu (Slide-out from left) -->
    <div class="lg:hidden fixed inset-0 z-50" x-data="{ mobileOpen: false }" x-on:toggle-mobile-menu.window="mobileOpen = !mobileOpen" x-show="mobileOpen" style="display: none;">
      <!-- Backdrop -->
      <div class="fixed inset-0 bg-black bg-opacity-50" x-on:click="mobileOpen = false" x-transition:enter="transition-opacity ease-linear duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-linear duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"></div>
      
      <!-- Mobile Menu Panel -->
      <div class="fixed inset-y-0 left-0 flex flex-col w-80 max-w-[85vw] bg-white shadow-xl" x-transition:enter="transition ease-in-out duration-300 transform" x-transition:enter-start="-translate-x-full" x-transition:enter-end="translate-x-0" x-transition:leave="transition ease-in-out duration-300 transform" x-transition:leave-start="translate-x-0" x-transition:leave-end="-translate-x-full">
        
        <!-- Header -->
        <div class="flex items-center justify-between px-4 py-4 border-b border-gray-200 bg-primary text-white">
          <div class="flex items-center">
            <i class="fas fa-car mr-2"></i>
            <h2 class="text-lg font-semibold">Dashboard Menu</h2>
          </div>
          <button @click="mobileOpen = false" class="p-2 hover:bg-white hover:bg-opacity-20 rounded-md touch-manipulation" aria-label="Close menu">
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>
        
        <!-- User Info -->
        <div class="px-4 py-4 border-b border-gray-200 bg-gray-50">
          <div class="flex items-center">
            <div class="w-12 h-12 bg-primary bg-opacity-20 rounded-full flex items-center justify-center mr-3">
              <i class="fas fa-user text-primary text-lg"></i>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900 truncate">{{ user.get_full_name|default:user.username }}</p>
              <p class="text-sm text-gray-600 truncate">{{ user.email }}</p>
              {% if user|has_group:'Staff' %}
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium mt-1 bg-purple-100 text-purple-800">
                  Staff
                </span>
              {% elif user|has_group:'AutoAssess' %}
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium mt-1 bg-blue-100 text-blue-800">
                  AutoAssess
                </span>
              {% elif user|has_group:'AutoCare' %}
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium mt-1 bg-green-100 text-green-800">
                  AutoCare
                </span>
              {% else %}
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium mt-1 bg-gray-100 text-gray-800">
                  User
                </span>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Quick Stats -->
        {% if navbar_data.quick_stats.total_vehicles > 0 %}
        <div class="px-4 py-3 border-b border-gray-200 bg-blue-50">
          <div class="grid grid-cols-3 gap-3 text-center">
            <div>
              <p class="text-lg font-semibold text-gray-900">{{ navbar_data.quick_stats.total_vehicles }}</p>
              <p class="text-xs text-gray-600">Vehicles</p>
            </div>
            <div>
              <p class="text-lg font-semibold {% if navbar_data.quick_stats.overdue_items > 0 %}text-red-600{% else %}text-gray-900{% endif %}">
                {{ navbar_data.quick_stats.overdue_items }}
              </p>
              <p class="text-xs text-gray-600">Overdue</p>
            </div>
            <div>
              <p class="text-lg font-semibold text-gray-900">{{ navbar_data.quick_stats.pending_maintenance }}</p>
              <p class="text-xs text-gray-600">Pending</p>
            </div>
          </div>
        </div>
        {% endif %}
        
        <!-- Navigation Links -->
        <div class="flex-1 overflow-y-auto py-4">
          <nav class="px-4 space-y-2">
            <a href="{% url 'dashboard' %}" @click="mobileOpen = false" 
              class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation
              {% if request.resolver_match.url_name == 'dashboard' %}bg-primary bg-opacity-10 text-primary border-r-2 border-primary{% endif %}">
              <i class="fas fa-tachometer-alt mr-3 w-5"></i>Dashboard Overview
            </a>
            
            <a href="#" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
              <i class="fas fa-car mr-3 w-5"></i>My Vehicles
              {% if navbar_data.quick_stats.total_vehicles > 0 %}
                <span class="ml-auto bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs">
                  {{ navbar_data.quick_stats.total_vehicles }}
                </span>
              {% endif %}
            </a>
            
            <a href="#" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
              <i class="fas fa-history mr-3 w-5"></i>Service History
            </a>
            
            <a href="{% url 'search' %}" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
              <i class="fas fa-search mr-3 w-5"></i>VIN Search
            </a>
            
            {% if user|has_group:'AutoCare' or user|has_group:'AutoAssess' %}
            <div class="border-t border-gray-200 my-2 pt-2">
              <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Technician Tools</p>
              <a href="{% url 'maintenance_history:technician_dashboard' %}" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
                <i class="fas fa-tools mr-3 w-5"></i>Technician Dashboard
              </a>
              <a href="#" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
                <i class="fas fa-clipboard-check mr-3 w-5"></i>Inspections
              </a>
            </div>
            {% endif %}
            
            {% if user|has_group:'Staff' %}
            <div class="border-t border-gray-200 my-2 pt-2">
              <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Admin</p>
              <a href="/admin/" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
                <i class="fas fa-shield-alt mr-3 w-5"></i>Admin Panel
              </a>
              <a href="#" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
                <i class="fas fa-users mr-3 w-5"></i>User Management
              </a>
            </div>
            {% endif %}
          </nav>
        </div>
        
        <!-- Footer Actions -->
        <div class="border-t border-gray-200 p-4 space-y-2">
          <a href="#" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
            <i class="fas fa-cog mr-3 w-5"></i>Settings
          </a>
          <a href="#" @click="mobileOpen = false" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition duration-200 touch-manipulation">
            <i class="fas fa-question-circle mr-3 w-5"></i>Help & Support
          </a>
          <a href="{% url 'logout' %}" class="flex items-center px-4 py-3 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition duration-200 touch-manipulation">
            <i class="fas fa-sign-out-alt mr-3 w-5"></i>Logout
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Key Metrics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
      <!-- Total Vehicles -->
      <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-primary bg-opacity-20 rounded-lg flex items-center justify-center">
              <i class="fas fa-car text-primary"></i>
            </div>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-500">Total Vehicles</p>
            <p class="text-2xl font-semibold text-gray-900">{{ dashboard_metrics.total_vehicles|default:0 }}</p>
            <p class="text-xs text-primary">Active fleet</p>
          </div>
        </div>
      </div>

      <!-- Upcoming Maintenance -->
      <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-warning bg-opacity-20 rounded-lg flex items-center justify-center">
              <i class="fas fa-wrench text-warning"></i>
            </div>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-500">Due Soon</p>
            <p class="text-2xl font-semibold text-gray-900">{{ dashboard_metrics.upcoming_maintenance|default:0 }}</p>
            <p class="text-xs text-warning">Next 30 days</p>
          </div>
        </div>
      </div>

      <!-- Overdue Services -->
      <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-danger bg-opacity-20 rounded-lg flex items-center justify-center">
              <i class="fas fa-exclamation-triangle text-danger"></i>
            </div>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-500">Overdue</p>
            <p class="text-2xl font-semibold text-gray-900">{{ dashboard_metrics.overdue_maintenance|default:0 }}</p>
            <p class="text-xs text-danger">Needs attention</p>
          </div>
        </div>
      </div>

      <!-- Vehicle Health -->
      <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-success bg-opacity-20 rounded-lg flex items-center justify-center">
              <i class="fas fa-heart text-success"></i>
            </div>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-500">Avg Health</p>
            <p class="text-2xl font-semibold text-gray-900">
              {% if dashboard_metrics.average_health %}
                {{ dashboard_metrics.average_health }}%
              {% else %}
                N/A
              {% endif %}
            </p>
            <p class="text-xs text-success">
              {% if dashboard_metrics.average_health >= 90 %}
                Excellent
              {% elif dashboard_metrics.average_health >= 75 %}
                Good condition
              {% elif dashboard_metrics.average_health >= 60 %}
                Fair condition
              {% else %}
                Needs attention
              {% endif %}
            </p>
          </div>
        </div>
      </div>

      <!-- Monthly Cost -->
      <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-secondary bg-opacity-20 rounded-lg flex items-center justify-center">
              <i class="fas fa-dollar-sign text-secondary"></i>
            </div>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-500">This Month</p>
            <p class="text-2xl font-semibold text-gray-900">${{ dashboard_metrics.monthly_cost|default:0|floatformat:0 }}</p>
            <p class="text-xs text-secondary">Maintenance costs</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Alerts Section -->
    <div class="mb-8">
      <div class="bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-medium text-gray-900">
                <i class="fas fa-bell text-warning mr-2"></i>
                Alerts & Notifications
              </h3>
              <p class="text-sm text-gray-500">Important maintenance and inspection alerts</p>
            </div>
            <button class="text-primary hover:text-blue-700 text-sm font-medium">
              View All
            </button>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <!-- Critical Alert -->
            <div class="flex items-start space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg">
              <div class="flex-shrink-0">
                <i class="fas fa-exclamation-circle text-danger text-lg"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">Oil Change Overdue - Toyota Camry</p>
                <p class="text-sm text-gray-600">Due 15 days ago at 75,000 miles. Current: 76,200 miles</p>
                <p class="text-xs text-gray-500 mt-1">VIN: 1HGBH41JXMN109186</p>
              </div>
              <button class="text-primary hover:text-blue-700 text-sm font-medium">
                Schedule
              </button>
            </div>

            <!-- Warning Alert -->
            <div class="flex items-start space-x-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
              <div class="flex-shrink-0">
                <i class="fas fa-exclamation-triangle text-warning text-lg"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">Brake Inspection Due - Honda Civic</p>
                <p class="text-sm text-gray-600">Due in 5 days or 500 miles</p>
                <p class="text-xs text-gray-500 mt-1">VIN: 2HGFC2F59HH123456</p>
              </div>
              <button class="text-primary hover:text-blue-700 text-sm font-medium">
                Schedule
              </button>
            </div>

            <!-- Info Alert -->
            <div class="flex items-start space-x-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
              <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-primary text-lg"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">Quarterly Inspection Available - Ford Focus</p>
                <p class="text-sm text-gray-600">50-point inspection can be scheduled</p>
                <p class="text-xs text-gray-500 mt-1">VIN: 1FADP3F20FL123789</p>
              </div>
              <button class="text-primary hover:text-blue-700 text-sm font-medium">
                Book Now
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
      <!-- Upcoming Maintenance -->
      <div class="lg:col-span-2 bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-medium text-gray-900">Upcoming Maintenance</h3>
              <p class="text-sm text-gray-500">Scheduled services and inspections</p>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
              <i class="fas fa-plus mr-2"></i>Schedule Service
            </button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vehicle</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Service</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mileage</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              {% if upcoming_maintenance_data %}
                {% for maintenance in upcoming_maintenance_data %}
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">{{ maintenance.assigned_plan.vehicle.make }} {{ maintenance.assigned_plan.vehicle.model }}</div>
                      <div class="text-sm text-gray-500">{{ maintenance.assigned_plan.vehicle.vin }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      {{ maintenance.task.name }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      {{ maintenance.due_date|date:"M d, Y" }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      {{ maintenance.due_mileage|floatformat:0 }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      {% if maintenance.status == 'OVERDUE' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                          Overdue
                        </span>
                      {% elif maintenance.status == 'PENDING' %}
                        {% if maintenance.due_date|is_due_soon %}
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            Due Soon
                          </span>
                        {% else %}
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Scheduled
                          </span>
                        {% endif %}
                      {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          {{ maintenance.get_status_display }}
                        </span>
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                      {% if maintenance.status == 'OVERDUE' or maintenance.status == 'PENDING' %}
                        <button class="text-primary hover:text-blue-700">Schedule</button>
                      {% else %}
                        <button class="text-primary hover:text-blue-700">View</button>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                    No upcoming maintenance scheduled
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Vehicle Health Overview -->
      <div class="bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Vehicle Health Overview</h3>
          <p class="text-sm text-gray-500">Latest inspection results</p>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            {% if vehicle_health_data %}
              {% for vehicle_health in vehicle_health_data %}
                <div class="border border-gray-200 rounded-lg p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div>
                      <p class="text-sm font-medium text-gray-900">{{ vehicle_health.vehicle.make }} {{ vehicle_health.vehicle.model }}</p>
                      <p class="text-xs text-gray-500">{{ vehicle_health.vehicle.vin }}</p>
                    </div>
                    <div class="text-right">
                      {% if vehicle_health.health_score %}
                        <p class="text-lg font-bold 
                          {% if vehicle_health.health_score >= 90 %}text-green-600
                          {% elif vehicle_health.health_score >= 75 %}text-yellow-600
                          {% elif vehicle_health.health_score >= 60 %}text-orange-600
                          {% else %}text-red-600{% endif %}">
                          {{ vehicle_health.health_score|floatformat:0 }}%
                        </p>
                        <p class="text-xs text-gray-500">{{ vehicle_health.health_category }}</p>
                      {% else %}
                        <p class="text-lg font-bold text-gray-400">N/A</p>
                        <p class="text-xs text-gray-500">No Data</p>
                      {% endif %}
                    </div>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-2">
                    {% if vehicle_health.health_score %}
                      <div class="h-2 rounded-full 
                        {% if vehicle_health.health_score >= 90 %}bg-green-600
                        {% elif vehicle_health.health_score >= 75 %}bg-yellow-600
                        {% elif vehicle_health.health_score >= 60 %}bg-orange-600
                        {% else %}bg-red-600{% endif %}" 
                        style="width: {{ vehicle_health.health_score }}%"></div>
                    {% else %}
                      <div class="bg-gray-400 h-2 rounded-full" style="width: 0%"></div>
                    {% endif %}
                  </div>
                  <p class="text-xs text-gray-500 mt-1">
                    {% if vehicle_health.last_inspection %}
                      Last inspection: {{ vehicle_health.last_inspection|date:"M d, Y" }}
                    {% else %}
                      No inspection data available
                    {% endif %}
                  </p>
                </div>
              {% endfor %}
            {% else %}
              <div class="text-center py-8">
                <i class="fas fa-heart text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">No vehicle health data available</p>
                <p class="text-sm text-gray-400">Add vehicles to see health information</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Inspection Reports & Maintenance History -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- Recent Inspection Reports -->
      <div class="bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-medium text-gray-900">Recent Inspection Reports</h3>
              <p class="text-sm text-gray-500">Quarterly and annual inspections</p>
            </div>
            <button class="text-primary hover:text-blue-700 text-sm font-medium">
              View All
            </button>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <!-- Inspection 1 -->
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-check-circle text-green-600"></i>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900">Q4 2024 - Toyota Camry</p>
                  <p class="text-xs text-gray-500">50-point inspection • Nov 15, 2024</p>
                  <p class="text-xs text-green-600">Passed with minor defects</p>
                </div>
              </div>
              <button class="text-primary hover:text-blue-700 text-sm">
                <i class="fas fa-file-pdf mr-1"></i>PDF
              </button>
            </div>

            <!-- Inspection 2 -->
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900">Q3 2024 - Honda Civic</p>
                  <p class="text-xs text-gray-500">50-point inspection • Oct 20, 2024</p>
                  <p class="text-xs text-yellow-600">Passed with major defects</p>
                </div>
              </div>
              <button class="text-primary hover:text-blue-700 text-sm">
                <i class="fas fa-file-pdf mr-1"></i>PDF
              </button>
            </div>

            <!-- Inspection 3 -->
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-times-circle text-red-600"></i>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900">Initial - Ford Focus</p>
                  <p class="text-xs text-gray-500">160-point inspection • Sep 10, 2024</p>
                  <p class="text-xs text-red-600">Failed due to major defects</p>
                </div>
              </div>
              <button class="text-primary hover:text-blue-700 text-sm">
                <i class="fas fa-file-pdf mr-1"></i>PDF
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Maintenance History -->
      <div class="bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-medium text-gray-900">Recent Maintenance</h3>
              <p class="text-sm text-gray-500">Latest service records</p>
            </div>
            <button class="text-primary hover:text-blue-700 text-sm font-medium">
              View All
            </button>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <!-- Service 1 -->
            <div class="flex items-start space-x-3 p-4 border border-gray-200 rounded-lg">
              <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-wrench text-blue-600"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">Oil Change & Filter</p>
                <p class="text-xs text-gray-500">Toyota Camry • Nov 10, 2024</p>
                <p class="text-xs text-gray-500">Mileage: 74,500 • Cost: $45.00</p>
                <p class="text-xs text-gray-400 mt-1">Technician: Mike Johnson</p>
              </div>
            </div>

            <!-- Service 2 -->
            <div class="flex items-start space-x-3 p-4 border border-gray-200 rounded-lg">
              <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-cog text-green-600"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">Brake Pad Replacement</p>
                <p class="text-xs text-gray-500">Honda Civic • Oct 15, 2024</p>
                <p class="text-xs text-gray-500">Mileage: 44,200 • Cost: $280.00</p>
                <p class="text-xs text-gray-400 mt-1">Technician: Sarah Davis</p>
              </div>
            </div>

            <!-- Service 3 -->
            <div class="flex items-start space-x-3 p-4 border border-gray-200 rounded-lg">
              <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-battery-half text-purple-600"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">Battery Replacement</p>
                <p class="text-xs text-gray-500">Ford Focus • Sep 20, 2024</p>
                <p class="text-xs text-gray-500">Mileage: 28,900 • Cost: $120.00</p>
                <p class="text-xs text-gray-400 mt-1">Technician: Alex Wilson</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions & Cost Analysis -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
      <!-- Quick Actions -->
      <div class="bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Quick Actions</h3>
          <p class="text-sm text-gray-500">Common tasks and shortcuts</p>
        </div>
        <div class="p-6">
          <div class="space-y-3">
            <button
              class="w-full flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors duration-200 group">
              <div class="w-8 h-8 bg-blue-600 text-white rounded-lg flex items-center justify-center mr-3">
                <i class="fas fa-plus text-sm"></i>
              </div>
              <span class="font-medium text-gray-900 text-sm">Schedule Maintenance</span>
            </button>

            <button
              class="w-full flex items-center p-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors duration-200 group">
              <div class="w-8 h-8 bg-green-600 text-white rounded-lg flex items-center justify-center mr-3">
                <i class="fas fa-clipboard-check text-sm"></i>
              </div>
              <span class="font-medium text-gray-900 text-sm">Book Inspection</span>
            </button>

            <button
              class="w-full flex items-center p-3 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition-colors duration-200 group">
              <div class="w-8 h-8 bg-purple-600 text-white rounded-lg flex items-center justify-center mr-3">
                <i class="fas fa-file-upload text-sm"></i>
              </div>
              <span class="font-medium text-gray-900 text-sm">Upload Documents</span>
            </button>

            <button
              class="w-full flex items-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg hover:bg-yellow-100 transition-colors duration-200 group">
              <div class="w-8 h-8 bg-yellow-600 text-white rounded-lg flex items-center justify-center mr-3">
                <i class="fas fa-chart-line text-sm"></i>
              </div>
              <span class="font-medium text-gray-900 text-sm">View Reports</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Cost Analysis -->
      <div class="lg:col-span-2 bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-medium text-gray-900">Maintenance Cost Analysis</h3>
              <p class="text-sm text-gray-500">Monthly spending trends</p>
            </div>
            <select class="text-sm border border-gray-300 rounded-md px-3 py-2">
              <option>Last 6 months</option>
              <option>Last 12 months</option>
              <option>This year</option>
            </select>
          </div>
        </div>
        <div class="p-6">
          <!-- Chart placeholder -->
          <div class="h-64 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg flex items-center justify-center">
            <div class="text-center">
              <i class="fas fa-chart-bar text-4xl text-blue-400 mb-4"></i>
              <p class="text-gray-600">Cost Analysis Chart</p>
              <p class="text-sm text-gray-500">Chart.js integration placeholder</p>
            </div>
          </div>

          <!-- Cost breakdown -->
          <div class="mt-6 grid grid-cols-3 gap-4">
            <div class="text-center p-4 bg-gray-50 rounded-lg">
              <p class="text-2xl font-bold text-gray-900">$445</p>
              <p class="text-sm text-gray-500">This Month</p>
              <p class="text-xs text-green-600">↓ 12% from last month</p>
            </div>
            <div class="text-center p-4 bg-gray-50 rounded-lg">
              <p class="text-2xl font-bold text-gray-900">$2,840</p>
              <p class="text-sm text-gray-500">Last 6 Months</p>
              <p class="text-xs text-red-600">↑ 8% from previous period</p>
            </div>
            <div class="text-center p-4 bg-gray-50 rounded-lg">
              <p class="text-2xl font-bold text-gray-900">$148</p>
              <p class="text-sm text-gray-500">Avg per Vehicle</p>
              <p class="text-xs text-gray-600">Monthly average</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Parts Inventory Alert -->
    <div class="bg-white rounded-lg shadow border border-gray-200 mb-8">
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-medium text-gray-900">
              <i class="fas fa-boxes text-warning mr-2"></i>
              Parts Inventory Status
            </h3>
            <p class="text-sm text-gray-500">Low stock alerts and part availability</p>
          </div>
          <button class="text-primary hover:text-blue-700 text-sm font-medium">
            Manage Inventory
          </button>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Low Stock Alert -->
          <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
            <div class="flex items-center justify-between mb-2">
              <p class="text-sm font-medium text-gray-900">Engine Oil Filter</p>
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                Low Stock
              </span>
            </div>
            <p class="text-xs text-gray-600">Current: 2 units • Minimum: 5 units</p>
            <p class="text-xs text-gray-500 mt-1">Part #: OF-2024-001</p>
          </div>

          <!-- Normal Stock -->
          <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
            <div class="flex items-center justify-between mb-2">
              <p class="text-sm font-medium text-gray-900">Brake Pads</p>
              <span
                class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                In Stock
              </span>
            </div>
            <p class="text-xs text-gray-600">Current: 12 units • Minimum: 3 units</p>
            <p class="text-xs text-gray-500 mt-1">Part #: BP-2024-002</p>
          </div>

          <!-- Reorder Soon -->
          <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <div class="flex items-center justify-between mb-2">
              <p class="text-sm font-medium text-gray-900">Air Filter</p>
              <span
                class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                Reorder Soon
              </span>
            </div>
            <p class="text-xs text-gray-600">Current: 6 units • Minimum: 5 units</p>
            <p class="text-xs text-gray-500 mt-1">Part #: AF-2024-003</p>
          </div>
        </div>
      </div>
    </div>

  </div>
</body>

</html>
<br></br>
{%else%}
{% include "dashboard/login_dashboard.html"%}
{%endif%}
{% endblock %}