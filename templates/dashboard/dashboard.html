{% extends 'base/base.html'%}
{% load static %}

{% block content %}
<br></br>
{% if user.is_authenticated %}
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <title>Dashboard</title>
          <script src="https://cdn.tailwindcss.com"></script>
        </head>
        <body class="bg-gray-100 text-gray-800 p-6">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- Left Cards -->
            <div class="space-y-6 md:col-span-1">
              <!-- Income Card -->
              <div class="bg-white p-5 rounded-lg shadow">
                <h2 class="text-lg font-semibold mb-2">Carfinity Evaluation</h2>
                <div class="text-2xl font-bold">E19 460.00</div>
                <div class="text-sm text-red-500">▼ 1.5%</div>
                <p class="text-sm text-gray-500">Compared to E19 870 yesterday</p>
                <p class="text-sm text-gray-500">Last week income</p>
              </div>
              <!-- Total Maintainance Cost Card -->
              <div class="bg-white p-5 rounded-lg shadow">
                <h2 class="text-lg font-semibold mb-2">Total Maintainance Cost</h2>
                <div class="text-2xl font-bold">E5 660.00</div>
                <div class="text-sm text-green-500">▲ 2.5%</div>
                <p class="text-sm text-gray-500">Compared to E3 240 previous period</p>
                <p class="text-sm text-gray-500">Last total maintainance <span class="font-medium">E3 568.00</span></p>
              </div>
              <!-- Hire vs Cancel -->
              <div class="bg-white p-5 rounded-lg shadow">
                <h2 class="text-lg font-semibold mb-4">Maintainance Tips</h2>
                <div class="flex items-center justify-center mb-4">
                  <div class="w-24 h-24 rounded-full border-8 border-blue-500 border-t-green-500 border-l-red-500"></div>
                </div>
                <ul class="text-sm">
                  <li><span class="text-blue-500 font-semibold">●</span> Total Hired – 54%</li>
                  <li><span class="text-red-500 font-semibold">●</span> Total Canceled – 20%</li>
                  <li><span class="text-green-500 font-semibold">●</span> Total Pending – 26%</li>
                </ul>
              </div>
            </div>

            <!-- Vehciles Owned by User Section -->
            <div class="md:col-span-3 space-y-6">
              <!-- Car Availability -->
              <form method="get" action="">
                <div class="bg-white p-5 rounded-lg shadow flex flex-wrap items-center gap-4">
                  <p>Owner</p>
                  <select class="p-2 border rounded-md" name="vehicle_id">
                    {% if owned_vehicles %}
                      {% for ownership in owned_vehicles %}
                        <option value="{{ ownership.vehicle.id }}" {% if ownership.vehicle.id|stringformat:'s' == request.GET.vehicle_id %}selected{% endif %}>
                          {{ ownership.vehicle.make }} {{ ownership.vehicle.model }} ({{ ownership.vehicle.vin }}) - Start: {{ ownership.start_date }}
                        </option>
                      {% endfor %}
                    {% else %}
                      <option>No vehicles found</option>
                    {% endif %}
                  </select>
                  <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md">Check</button>
                </div>
              </form>

              <!-- Schedules Maintainance Section -->
              <div class="bg-white p-5 rounded-lg shadow">
                <div class="flex justify-between mb-4">
                  <h2 class="text-lg font-semibold">Upcoming Maintainance</h2>
                  <button class="text-blue-500 text-sm">Filter</button>
                </div>
                <div class="overflow-x-auto">
                  <table class="min-w-full text-left text-sm">
                    <thead>
                      <tr class="border-b font-semibold text-gray-700">
                        <th class="p-2">No.</th>
                        <th class="p-2">Task</th>
                        <th class="p-2">Due Date</th>
                        <th class="p-2">Due Mileage</th>
                        <th class="p-2">Status</th>
                        <th class="p-2"></th>
                      </tr>
                    </thead>
                    <tbody>
                      {% if scheduled_maintenance and scheduled_maintenance|length > 0 %}
                        {% for sm in scheduled_maintenance %}
                          <tr class="border-b">
                            <td class="p-2">{{ forloop.counter }}</td>
                            <td class="p-2">{{ sm.task.name }}</td>
                            <td class="p-2">{{ sm.due_date }}</td>
                            <td class="p-2">{{ sm.due_mileage }}</td>
                            <td class="p-2">{{ sm.get_status_display }}</td>
                            <td class="p-2"><button class="text-blue-500">Details</button></td>
                          </tr>
                        {% endfor %}
                      {% else %}
                        <tr><td colspan="6" class="p-2 text-center text-gray-400">No scheduled maintenance found.</td></tr>
                      {% endif %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Inspection Reports Summary -->
              <div class="bg-white p-5 rounded-lg shadow">
                <div class="flex justify-between mb-4">
                  <h2 class="text-lg font-semibold">Quarterly Inspection Reports</h2>
                  <button class="text-blue-500 text-sm">Filter</button>
                </div>
                <div class="overflow-x-auto">
                  <table class="min-w-full text-left text-sm">
                    <thead>
                      <tr class="border-b font-semibold text-gray-700">
                        <th class="p-2">No.</th>
                        <th class="p-2">Inspection #</th>
                        <th class="p-2">Year</th>
                        <th class="p-2">Result</th>
                        <th class="p-2">Carfinity Rating</th>
                        <th class="p-2">Date</th>
                        <th class="p-2"></th>
                      </tr>
                    </thead>
                    <tbody>
                      {% if inspections and inspections|length > 0 %}
                        {% for insp in inspections %}
                          <tr class="border-b">
                            <td class="p-2">{{ forloop.counter }}</td>
                            <td class="p-2">{{ insp.inspection_number }}</td>
                            <td class="p-2">{{ insp.year }}</td>
                            <td class="p-2">{{ insp.get_inspection_result_display }}</td>
                            <td class="p-2">{{ insp.carfinity_rating }}</td>
                            <td class="p-2">{{ insp.inspection_date }}</td>
                            <td class="p-2"><a href="{{ insp.link_to_results }}" class="text-blue-500" target="_blank">Results</a></td>
                          </tr>
                        {% endfor %}
                      {% else %}
                        <tr><td colspan="7" class="p-2 text-center text-gray-400">No inspection reports found.</td></tr>
                      {% endif %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Earning Summary -->
              <div class="bg-white p-5 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                  <h2 class="text-lg font-semibold">Carfinity Summary</h2>
                  <select class="text-sm border rounded px-2 py-1">
                    <option>Mar 2022 - Oct 2022</option>
                  </select>
                </div>
                <div class="h-40 bg-gradient-to-br from-blue-100 to-blue-200 rounded-md flex items-center justify-center text-gray-500 italic">
                  Chart Placeholder (Use Chart.js here)
                </div>
                <div class="text-sm mt-2 flex justify-between">
                  <span class="text-blue-500">● Last 6 months</span>
                  <span class="text-gray-400">● Same period last year</span>
                </div>
              </div>
            </div>
          </div>
        </body>
        </html>
        <br></br>
{%else%}
  {% include "dashboard/login_dashboard.html"%}
{%endif%}
{% endblock %}
